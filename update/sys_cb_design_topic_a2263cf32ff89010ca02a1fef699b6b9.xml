<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Service Disruptions">a2263cf32ff89010ca02a1fef699b6b6</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"8922d3ce5b6749d6856927dcb5fe062f","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":"true"},"id":"8922d3ce5b6749d6856927dcb5fe062f"}],"goals":[{"name":"Outage Info","trigger_id":"8922d3ce5b6749d6856927dcb5fe062f","nodes":[{"type":"StartGoal","goal_id":"2c7aed2c2aab43f18636fe70981fd241","greeting_msg":{"type":"String","mode":"string","value":""},"id":"7eaea6d27e2c4ebdacc03745d7934fea","name":"Start","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"TerminateGoal","goal_id":"2c7aed2c2aab43f18636fe70981fd241","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"1d63602e607647e888c51e9a7d2b17b8","name":"End","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"fc28755cdb614417b6ec0b7463d28c79","name":"List Outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"},"variable_id":"feb374539d6349fb844e882a8c16caa1","message":{"type":"String","mode":"string","value":"Here are the known outages. Please select one for details, or select [I'm done] to exit."},"optional":false,"nlu_entity_binding":{"type":"NLUEntityBinding","name":"","allow_text_input":false,"use_confirmation_prompt":true},"expression_mode":"script","script":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n\n    // query current and future planned outages \n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('cmdb_ci') + ': ' + gr.getDisplayValue('type') });\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit ) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    options.push({ 'value': 'cancel', 'label': gs.getMessage(\"I'm done\")});\n\n\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"Sorry, I had a problem finding outages. Let me try that again."},"condition":{"type":"Condition","mode":"external_script","value":"(function execute() {\n    var options = [];\n\n    // get variables\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var count = 0;\n\n    // query current and future planned outages \n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, used for pagination\n    count = gr.getRowCount();\n    vaVars.count = count;\n\n    // page of outage records\n    var cnt = 0;\n    while(gr.next()) {\n        options.push({ 'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('cmdb_ci') + ': ' + gr.getDisplayValue('type') });\n        cnt++;\n    }\n\n    var totalPages = Math.ceil(count / limit).toString();\n    var currentPage = Math.ceil((index+1) / limit).toString();\n\n    // previous and next buttons\n    if ( index &gt; 0 &amp;&amp; cnt &gt; 0 ) {\n        options.push({ 'value': 'prev', 'label': gs.getMessage('Show previous')});\n    }\n    if ( count &gt; index + limit ) {\n        options.push({ 'value': 'next', 'label': gs.getMessage('Show more')});\n    }\n    options.push({ 'value': 'cancel', 'label': gs.getMessage(\"I'm done\")});\n\n\n    return options;\n})()\n"},"table":"cmdb_ci_outage"},{"type":"Decision","name":"Next Page","branches":[{"type":"Branch","label":"Outage","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() != 'next' &amp;&amp; vaInputs.list_outages.getValue() != 'prev' \n        &amp;&amp; vaInputs.list_outages.getValue() != 'cancel' &amp;&amp; vaInputs.list_outages.getValue() != '';\n})()\n"},"id":"2683d1b5220a42b88af1986a3ed150fd","name":"Outage"},{"type":"Branch","label":"Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages == 'next';\n})()\n"},"id":"a1f70af2c10a489a839d4e2f14df5e6a","name":"Next"},{"type":"Branch","label":"Previous","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() == 'prev';\n})()\n"},"id":"ef09185052bd4745967f6346af03c448","name":"Previous"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.list_outages.getValue() == 'cancel';\n})()\n"},"id":"8602874e0f7b4c1fbb40241949e63f05","name":"Cancel"}],"id":"cd1f6b2e068440f0bf8401f219d808c3","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n\n    // query current and future planned outages to get the updated count\n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.chooseWindow(index, index + limit, true);\n    gr.query();\n\n    // get total count, to check for existence of next page\n    vaVars.count = gr.getRowCount();\n\n    // next page math\n    var count = parseInt(vaVars.count);\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    if ( index + limit &gt;= count )\n        vaVars.index = 0;\n    else\n        vaVars.index = index + limit;\n    return '';\n})()\n","id":"5c42baa5ae1f4199b86f31acff592704","name":"Next Page","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var c = index - limit;\n    if ( c &lt; 0 ) c = 0;\n    vaVars.index = c;\n    return '';\n})()\n","id":"cbaa4f828189449d85221c28a95f4baf","name":"Previous Page","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Great news, there are no known outages!\", vaContext.getRequesterLang())"},"id":"64544a1418d2457789d5cd8d201f0328","name":"No outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Currently, there is only one known outage.\", vaContext.getRequesterLang())"},"id":"2309af1e0dda42a79754b2e962e117b3","name":"One Outage","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    // reset to first page\n    vaVars.index = 0;\n\n    // count how many outages there are\n    var count = 0;\n    var gr = new GlideAggregate('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.addAggregate('COUNT');\n    gr.query();\n    if (gr.next())\n        count = gr.getAggregate('COUNT');\n    \n    // set count variable\n    vaVars.count = count;\n})()\n","id":"23ae032775dd46b8beac532e1d223e09","name":"Check Outages","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Count Decision","branches":[{"type":"Branch","label":"Many Outages","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count &gt; 1;\n})()"},"id":"c61c3363a9e64cbba7e9700aaebfce77","name":"Many Outages"},{"type":"Branch","label":"No Outages","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count == 0;\n})()\n"},"id":"3799508ae6bc4c3c8bb9a0fbae1f592a","name":"No Outages"},{"type":"Branch","label":"One Outage","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.count == 1;\n})()\n"},"id":"fb0f32fa62f14f70ac410999e33e13a8","name":"One Outage"}],"id":"ce8be2d5eb824acf99642dca6883d613","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"RecordOutputPrompt","mode":"script","table":"cmdb_ci_outage","script":"(function execute(table) {\n       var gr = new GlideRecord(table);       \n       if(gr.get(vaInputs.list_outages)) {\n          return gr;\n    }\n})(table)\n","fields":["cmdb_ci","type","duration","begin","end"],"id":"666cb193125343d4bd06109bf29dbe81","name":"Display Outage Card","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"},"condition":{"type":"Condition","mode":"glide_scripted_query","value":"(function execute(table) {\n       var gr = new GlideRecord(table);       \n       if(gr.get(vaInputs.list_outages)) {\n          return gr;\n    }\n})(table)\n"}},{"type":"RecordOutputPrompt","mode":"script","table":"cmdb_ci_outage","script":"(function execute(table) {\n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.setLimit(1);\n    gr.query();\n\n    if(gr.next()) {\n        return gr;\n    }\n})(table)\n","fields":["cmdb_ci","type","duration","begin","end"],"id":"79ce14c6fdce41c889f7a1e1f3b1c87a","name":"Display Single Outage","goal_id":"2c7aed2c2aab43f18636fe70981fd241","applicability":{"type":"Applicability","mode":"script","value":"true"},"condition":{"type":"Condition","mode":"glide_scripted_query","value":"(function execute(table) {\n    var gr = new GlideRecord('cmdb_ci_outage');\n    gr.addEncodedQuery('begin&lt;=javascript:gs.endOfToday()^endISEMPTY^ORend&gt;javascript:gs.endOfToday()^NQtype=planned^beginRELATIVELE@dayofweek@ahead@7^end&gt;javascript:gs.endOfToday()');\n    gr.orderBy('begin');\n    gr.setLimit(1);\n    gr.query();\n\n    if(gr.next()) {\n        return gr;\n    }\n})(table)\n"}}],"edges":[{"type":"Edge","source_node_id":"666cb193125343d4bd06109bf29dbe81","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","id":"c4e979e451f14f10aa3933725b64dd9a"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"666cb193125343d4bd06109bf29dbe81","branch_id":"2683d1b5220a42b88af1986a3ed150fd","id":"7d24887e2ca94644b8a071d8881d0a37","name":"2683d1b5220a42b88af1986a3ed150fd"},{"type":"Edge","source_node_id":"2309af1e0dda42a79754b2e962e117b3","target_node_id":"79ce14c6fdce41c889f7a1e1f3b1c87a","id":"12ff960509124c31a8d565c6dea3e5b3"},{"type":"Edge","source_node_id":"64544a1418d2457789d5cd8d201f0328","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","id":"fb46d4e38a064bd4a020baacb348ab7d"},{"type":"Edge","source_node_id":"fc28755cdb614417b6ec0b7463d28c79","target_node_id":"cd1f6b2e068440f0bf8401f219d808c3","id":"e376f86a9a7e4bdaa91a007203f89d4a"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"5c42baa5ae1f4199b86f31acff592704","branch_id":"a1f70af2c10a489a839d4e2f14df5e6a","id":"f57e773cd7d749cca1e015fd1e03ba28","name":"a1f70af2c10a489a839d4e2f14df5e6a"},{"type":"Edge","source_node_id":"5c42baa5ae1f4199b86f31acff592704","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","id":"3ed6c4301b354e8fb255e4e15fd1a050"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"cbaa4f828189449d85221c28a95f4baf","branch_id":"ef09185052bd4745967f6346af03c448","id":"3688613b514941c7ae273d871d45b1ca","name":"ef09185052bd4745967f6346af03c448"},{"type":"Edge","source_node_id":"cbaa4f828189449d85221c28a95f4baf","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","id":"ec188e093c1842318b3e6911e2f3b0c1"},{"type":"Edge","source_node_id":"7eaea6d27e2c4ebdacc03745d7934fea","target_node_id":"23ae032775dd46b8beac532e1d223e09","id":"0dbc0a89dbc54e5fb956aef819f1692b"},{"type":"Edge","source_node_id":"23ae032775dd46b8beac532e1d223e09","target_node_id":"ce8be2d5eb824acf99642dca6883d613","id":"da05d5c5dc6c4519a1436b7186f7240c"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"fc28755cdb614417b6ec0b7463d28c79","branch_id":"c61c3363a9e64cbba7e9700aaebfce77","id":"6637f797d40b48f4b8d0e83f43c9d720","name":"c61c3363a9e64cbba7e9700aaebfce77"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"64544a1418d2457789d5cd8d201f0328","branch_id":"3799508ae6bc4c3c8bb9a0fbae1f592a","id":"1a8d988bec484963934b1e9f4f72e741","name":"3799508ae6bc4c3c8bb9a0fbae1f592a"},{"type":"Edge","source_node_id":"ce8be2d5eb824acf99642dca6883d613","target_node_id":"2309af1e0dda42a79754b2e962e117b3","branch_id":"fb0f32fa62f14f70ac410999e33e13a8","id":"da9569080a49404cae67eb6c824ad4d1","name":"fb0f32fa62f14f70ac410999e33e13a8"},{"type":"Edge","source_node_id":"cd1f6b2e068440f0bf8401f219d808c3","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","branch_id":"8602874e0f7b4c1fbb40241949e63f05","id":"21617cb4ae5b4734ab5447bc0ca31873","name":"8602874e0f7b4c1fbb40241949e63f05"},{"type":"Edge","source_node_id":"79ce14c6fdce41c889f7a1e1f3b1c87a","target_node_id":"1d63602e607647e888c51e9a7d2b17b8","id":"b5414a5d4c9f446a91a048536cc580d9"}],"id":"2c7aed2c2aab43f18636fe70981fd241"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"script","value":"5"},"id":"779afb88ec184bde8131feff718f9843"},{"type":"String","name":"index","value":{"type":"String","mode":"script","value":"0"},"id":"835b6c93ccc64d37b3765f433f77b58f"},{"type":"String","name":"count","value":{"type":"String","mode":"script","value":"0"},"id":"10c6f0ed864b45f1a5776dcf1f915664"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"4e05edb424644bfc85eb01ca296c746b"}],"glide_variables":[{"type":"Choice","choices":[],"id":"feb374539d6349fb844e882a8c16caa1","name":"list_outages","table":"cmdb_ci_outage"},{"type":"Reference","table":"sys_user","id":"current-user","name":"user"}],"applicability":{"type":"Applicability","mode":"script","value":"true"},"roles":[],"scope":"134450a0b3781300787162ac16a8dc1e","domain":"global","id":"08f9f9f63b01130028fa456993efc444","name":"Service Disruptions","key_phrases":["service disruptions","down","outage","not working","maintenance","system status","disruption","service"],"nlu_provider":"","nlu_model":"sn_itsm_nlu_ITSM_NLU_for_VA","nlu_model_label":"","nlu_intent":"ServiceDisruptions","nlu_intent_label":"","flexible_conversation_switching":false,"design_category":"3efd22da0b203300a1b16c2367673a10","library":false}</design_definition>
        <design_topic_id>08f9f9f63b01130028fa456993efc444</design_topic_id>
        <name>Service Disruptions</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-05-22 09:30:34</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>a2263cf32ff89010ca02a1fef699b6b9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_a2263cf32ff89010ca02a1fef699b6b9</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-05-22 09:30:34</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
